

# Бизнес-требования — Ядро-движок чатов

## 1. Создание чатов

**US-001**  
Как **Разработчик**, я хочу иметь возможность создавать чаты между пользователями, чтобы реализовать коммуникационный функционал в своем мессенджере.  
**AC-001**
- *Дано:* Два или более зарегистрированных пользователя.
- *Когда:* Вызывается метод `createChat([userA, userB])`.
- *Тогда:* Система создает новый чат, присваивает ему уникальный ID и сохраняет список участников.

---

## 2. Удаление чатов

**US-002**  
Как **Администратор системы**, я хочу иметь возможность удалять чаты, чтобы управлять коммуникациями и соблюдать политику хранения данных.  
**AC-002**
- *Дано:* Чат с ID=12345.
- *Когда:* Администратор вызывает метод `deleteChat(12345)`.
- *Тогда:* Чат удаляется у всех участников. Все сообщения и метаданные также удаляются. Восстановление невозможно.

---

## 3. Отправка сообщений

**US-003**  
Как **Пользователь мессенджера**, я хочу отправлять сообщения в чат, чтобы обмениваться информацией.  
**AC-003**
- *Дано:* Открыт чат с участниками A и B.
- *Когда:* Пользователь A отправляет текстовое сообщение "Привет!".
- *Тогда:* Сообщение появляется у пользователя B. Статус "Доставлено" отображается у A.

---

## 4. Хранение истории сообщений

**US-004**  
Как **Пользователь**, я хочу видеть историю сообщений в чате, чтобы не терять контекст общения.  
**AC-004**
- *Дано:* Чат с 10 сообщениями.
- *Когда:* Пользователь открывает чат.
- *Тогда:* Система загружает всю историю сообщений, включая дату, текст и статус прочитанности.

---

## 5. Уведомления о прочитанности

**US-005**  
Как **Пользователь**, я хочу видеть, прочитал ли собеседник мое сообщение, чтобы понимать статус коммуникации.  
**AC-005**
- *Дано:* Пользователь A отправил сообщение в чат.
- *Когда:* Пользователь B открыл чат и прочитал сообщение.
- *Тогда:* У пользователя A появляется статус "Прочитано" под этим сообщением.

---

## 6. Поддержка разных типов чатов

**US-006**  
Как **Разработчик**, я хочу использовать один движок для разных типов чатов (1:1, групповые, публичные), чтобы не писать логику с нуля.  
**AC-006**
- *Дано:* Пользователь может создать чат с типом.
- *Когда:* Выбирается тип чата: `private`, `group`, `public`.
- *Тогда:* Система применяет соответствующие правила (например, только администратор может добавлять участников в групповой чат).

---

## 7. Расширяемость логики

**US-007**  
Как **Разработчик**, я хочу иметь возможность добавлять кастомную логику к событиям в чате, чтобы интегрировать её в свою систему.  
**AC-007**
- *Дано:* Событие `onMessageSent`.
- *Когда:* Разработчик подключает свой обработчик к событию.
- *Тогда:* При отправке сообщения в чат, срабатывает кастомный обработчик (например, отправка в CRM или логирование).

---

## 8. Поддержка разных интерфейсов

**US-008**  
Как **UI/UX-дизайнер**, я хочу использовать движок чатов с любым интерфейсом, чтобы создать уникальный клиент для своего продукта.  
**AC-008**
- *Дано:* Два разных интерфейса: веб и мобильное приложение.
- *Когда:* Пользователь отправляет сообщение через мобильное приложение.
- *Тогда:* Сообщение отображается в веб-интерфейсе, и наоборот.

---

## 9. Push- и in-app уведомления

**US-009**  
Как **Пользователь**, я хочу получать уведомления о новых сообщениях, чтобы не пропустить важные коммуникации.  
**AC-009**
- *Дано:* Пользователь A оффлайн.
- *Когда:* Пользователь B отправляет сообщение в чат.
- *Тогда:* Пользователь A получает push-уведомление (если клиент поддерживает) или in-app уведомление при входе в систему.

---

## 10. Редактирование сообщений

**US-010**  
Как **Пользователь**, я хочу иметь возможность редактировать свои сообщения, чтобы исправлять ошибки.  
**AC-010**
- *Дано:* Сообщение "Встречаемся в 15:00" отправлено 3 минуты назад.
- *Когда:* Пользователь редактирует сообщение на "Встречаемся в 15:30".
- *Тогда:* У всех участников отображается обновленное сообщение. В интерфейсе ставится отметка "редактировано".

---

## 11. Управление участниками

**US-011**  
Как **Администратор группового чата**, я хочу управлять участниками, чтобы контролировать состав и доступ.  
**AC-011**
- *Дано:* Групповой чат с 5 участниками.
- *Когда:* Администратор добавляет или удаляет участника.
- *Тогда:* Состав чата обновляется у всех участников. У удаленного участника чат скрывается.

---

## 12. Кроссплатформенная синхронизация

**US-012**  
Как **Пользователь**, я хочу, чтобы чаты и статусы сообщений синхронизировались между вебом и мобильным приложением.  
**AC-012**
- *Дано:* Пользователь A открыл чат на мобильном устройстве.
- *Когда:* Пользователь B отправляет сообщение в чат.
- *Тогда:* Сообщение появляется у A на веб-интерфейсе и мобильном приложении в течение 1 секунды.

---

## 13. API для интеграций

**US-013**  
Как **Разработчик**, я хочу использовать API, чтобы подключить движок к своему приложению и интегрировать его в существующую систему.  
**AC-013**
- *Дано:* Документация к API.
- *Когда:* Вызываются методы `/chat/list`, `/chat/send`, `/chat/read`.
- *Тогда:* Все методы возвращают корректные ответы в формате JSON. Примеры запросов и ответов доступны в документации.

---

## 14. Мультитенантность

**US-014**  
Как **Архитектор**, я хочу использовать один движок для нескольких независимых мессенджеров, чтобы не дублировать логику.  
**AC-014**
- *Дано:* Два приложения: "Корпоративный чат" и "Чат с клиентами".
- *Когда:* Пользователь из одного приложения отправляет сообщение.
- *Тогда:* Сообщение не отображается в другом приложении. Данные полностью изолированы между тенантами.

---

## 15. Подписка на события чатов

**US-015**  
Как **Разработчик**, я хочу подписываться на события (новое сообщение, удаление чата), чтобы реагировать на них в реальном времени.  
**AC-015**
- *Дано:* Поддержка WebSocket или webhook.
- *Когда:* Событие `onMessageSent` или `onChatDeleted` происходит.
- *Тогда:* Подписчики получают payload события в течение 1 секунды. События можно обрабатывать в отдельных микросервисах.

---

## 16. Управление правами в чате

**US-016**  
Как **Администратор чата**, я хочу назначать участникам разные роли (чтение, отправка, удаление), чтобы контролировать доступ.  
**AC-016**
- *Дано:* Чат с участниками A (админ), B (чтение), C (отправка).
- *Когда:* Участник B пытается отправить сообщение.
- *Тогда:* Система блокирует отправку. Участник C может отправлять, но не может удалять чат.

---

## 17. Поиск по сообщениям

**US-017**  
Как **Пользователь**, я хочу искать по тексту в чате, чтобы быстро находить нужную информацию.  
**AC-017**
- *Дано:* Чат с 100 сообщениями.
- *Когда:* Пользователь вводит "договор".
- *Тогда:* Система отображает все сообщения, содержащие этот текст, с подсветкой совпадений.

---

## 18. Аудит действий в чатах

**US-018**  
Как **Юрист**, я хочу, чтобы в системе велся журнал действий в чатах, чтобы иметь возможность отследить изменения.  
**AC-018**
- *Дано:* Сообщение в чате было удалено.
- *Когда:* Система записывает событие в журнал.
- *Тогда:* В логе указаны: ID чата, ID пользователя, тип действия, дата.

---

## 19. Кэширование чатов

**US-019**  
Как **Архитектор**, я хочу, чтобы чаты кэшировались, чтобы повысить производительность и снизить нагрузку на сервер.  
**AC-019**
- *Дано:* Пользователь открывает чат дважды.
- *Когда:* Второй запрос на историю чата.
- *Тогда:* Данные берутся из кэша, если он актуален. Время ответа уменьшается на 40%.

---

## 20. Локализация и интернационализация

**US-020**  
Как **Пользователь**, я хочу, чтобы интерфейс чата поддерживал мой язык и форматы дат, чтобы чувствовать себя комфортно.  
**AC-020**
- *Дано:* Пользователь выбрал язык "ru" и локаль "ru-RU".
- *Когда:* Пользователь открывает чат.
- *Тогда:* Все метки, уведомления, даты и форматы отображаются на русском языке и в российском формате.

---

### Ключевые принципы оформления:
1. **Роли** — с описанием типа пользователя, где это важно.
2. **Ценность** — каждая US содержит конкретную бизнес-цель, а не просто "удобство".
3. **AC** —
  - Проверяемые.
  - Измеримые.
  - Ориентированные на сценарии использования.
4. **Приоритеты** — ориентируемся на разработчика, пользователя и архитектора.

---
