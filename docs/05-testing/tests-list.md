
---

### **FR-001: Создание чата**
| **Test ID** | T-001                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-001                                                               |
| **Scenario** | Создание группового чата с 5 участниками                              |
| **Preconditions** | 1. Все участники зарегистрированы<br>2. Пользователь авторизован      |
| **Test Steps** | **Given:** Открыта форма "Новый чат"<br>**When:** Выбрано 5 пользователей и нажата кнопка "Создать"<br>**Then:**br> - Создан новый чат с уникальным ID<br> - Возвращается список участников<br> - Чат отображается в списке у всех участников |
| **Test Data** | Участники: user1, user2, user3, user4, user5                          |
| **Pass Criteria** | 1. Чат создан<br>2. У всех участников отображается в списке<br>3. ID уникален<br>4. Время создания ≤1 сек |
| **Environment** | STAGING (Postman, UI)                                                  |

---

### **FR-002: Удаление чата**
| **Test ID** | T-002                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-002                                                               |
| **Scenario** | Администратор удаляет чат из UI                                      |
| **Preconditions** | 1. Чат существует<br>2. Пользователь авторизован как администратор   |
| **Test Steps** | **Given:** Открыт чат с участниками A и B<br>**When:** Администратор нажимает "Удалить чат"<br>**Then:**br> - Чат удален у всех участников<br> - Все сообщения удалены из БД<br> - В логах запись об удалении |
| **Test Data** | ID чата: CH-2024-001                                                  |
| **Pass Criteria** | 1. Чат не отображается в списке<br>2. Сообщения недоступны через API<br>3. Логи содержат запись об удалении |
| **Environment** | PROD-like (в тестовой среде с логированием)                            |

---

### **FR-003: Отправка сообщений**
| **Test ID** | T-003                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-003                                                               |
| **Scenario** | Отправка текстового сообщения с файлом .pdf (8 МБ)                     |
| **Preconditions** | 1. Чат создан<br>2. Пользователь авторизован                         |
| **Test Steps** | **Given:** Пользователь A в чате с пользователем B<br>**When:** Отправляет сообщение "Привет!" и прикрепляет файл `договор.pdf`br>**Then:**br> - У пользователя B появляется сообщение и файл<br> - Файл доступен для скачивания |
| **Test Data** | Сообщение: "Привет!"br>Файл: договор.pdf (8 МБ)                     |
| **Pass Criteria** | 1. Сообщение и файл получены<br>2. Файл доступен<br>3. Задержка доставки ≤2 сек |
| **Environment** | DEV (веб + мобильный клиент)                                          |

---

### **FR-004: Хранение истории сообщений**
| **Test ID** | T-004                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-004                                                               |
| **Scenario** | Повторное открытие чата через 3 дня                                   |
| **Preconditions** | 1. Чат с историей из 20 сообщений существует<br>2. Пользователь авторизован |
| **Test Steps** | **Given:** Пользователь A открыл чат<br>**When:** Через 3 дня он снова открывает чат<br>**Then:**br> - Отображаются все 20 сообщений<br> - Файлы доступны<br> - Дата и время сообщений корректны |
| **Test Data** | ID чата: CH-2024-001<br>Сообщения: 20 шт                             |
| **Pass Criteria** | 1. История восстановлена полностью<br>2. Файлы доступны<br>3. Время отклика ≤1.5 сек |
| **Environment** | STAGING (PostgreSQL, Redis)                                            |

---

### **FR-005: Уведомления о прочитанности**
| **Test ID** | T-005                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-005                                                               |
| **Scenario** | Отправка и прочтение сообщения в чате 1:1                              |
| **Preconditions** | 1. Чат создан между A и B<br>2. Пользователь A отправил сообщение    |
| **Test Steps** | **Given:** Пользователь A отправил сообщение "Привет"<br>**When:** Пользователь B открывает чат и читает сообщение<br>**Then:**br> - У A отображается "Прочитано"<br> - В системе генерируется событие `messageRead` |
| **Test Data** | Сообщение: "Привет"<br>Участники: userA, userB                        |
| **Pass Criteria** | 1. Метка "Прочитано" появляется<br>2. Событие доставлено<br>3. Задержка ≤1 сек |
| **Environment** | DEV (WebSocket, UI)                                                    |

---

### **FR-006: Поддержка разных типов чатов**
| **Test ID** | T-006                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-006                                                               |
| **Scenario** | Создание публичного чата с 10 участниками                             |
| **Preconditions** | 1. Пользователь авторизован<br>2. Поддержка групповых чатов включена   |
| **Test Steps** | **Given:** Пользователь A создает чат типа "Публичный"<br>**When:** Добавляет 10 участников<br>**Then:**br> - Все участники получают приглашение<br> - Чат доступен для новых участников по ссылке |
| **Test Data** | Тип: Публичный<br>Участники: user1–user10                            |
| **Pass Criteria** | 1. Чат создан с указанным типом<br>2. Все участники получают приглашение<br>3. Ссылка для присоединения работает |
| **Environment** | PROD-like (веб- и мобильный клиенты)                                  |

---

### **FR-007: Расширяемая логика чатов**
| **Test ID** | T-007                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-007                                                               |
| **Scenario** | Подключение плагина для автоматической отправки сообщения в CRM      |
| **Preconditions** | 1. Плагин `CRM-Integration` установлен<br>2. Чат с сообщением создан |
| **Test Steps** | **Given:** Пользователь отправляет сообщение в чат<br>**When:** Срабатывает событие `messageSent`br>**Then:**br> - Плагин отправляет сообщение в CRM<br> - Лог плагина содержит запись об отправке |
| **Test Data** | Сообщение: "Нужно обсудить договор"<br>Плагин: CRM-Integration        |
| **Pass Criteria** | 1. Сообщение отправлено в CRM<br>2. Лог плагина содержит `onMessageSent`br>3. Нет ошибок в логе |
| **Environment** | DEV (плагины, движок чатов)                                            |

---

### **FR-008: Поддержка нескольких интерфейсов**
| **Test ID** | T-008                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-008                                                               |
| **Scenario** | Отправка сообщения с мобильного приложения и чтение с веб-интерфейса  |
| **Preconditions** | 1. Пользователь авторизован на обоих интерфейсах                      |
| **Test Steps** | **Given:** Пользователь в чате на телефоне<br>**When:** Отправляет сообщение "На встрече через 10 минут"<br>**Then:**br> - Сообщение отображается в веб-интерфейсе<br> - Текст и метка времени совпадают |
| **Test Data** | Сообщение: "На встрече через 10 минут"                                |
| **Pass Criteria** | 1. Сообщение отображается в обоих интерфейсах<br>2. Время синхронизации ≤1.5 сек<br>3. Текст совпадает |
| **Environment** | STAGING (веб + мобильный клиент)                                       |

---

### **FR-009: Уведомления в чате**
| **Test ID** | T-009                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-009                                                               |
| **Scenario** | Получение in-app уведомления о новом сообщении                        |
| **Preconditions** | 1. Пользователь B подписан на уведомления<br>2. Чат с пользователем A открыт у B |
| **Test Steps** | **Given:** Пользователь A отправляет сообщение<br>**When:** Система генерирует уведомление<br>**Then:**br> - У B появляется всплывающее уведомление<br> - Звуковой сигнал воспроизводится |
| **Test Data** | Сообщение: "Ты где?"                                                  |
| **Pass Criteria** | 1. Уведомление появилось<br>2. Звук воспроизведён<br>3. Задержка уведомления ≤1 сек |
| **Environment** | PROD-like (веб-клиент, FCM)                                            |

---

### **FR-010: Редактирование сообщений**
| **Test ID** | T-010                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-010                                                               |
| **Scenario** | Редактирование сообщения в течение 5 минут                              |
| **Preconditions** | 1. Сообщение отправлено 3 минуты назад<br>2. Пользователь авторизован |
| **Test Steps** | **Given:** Пользователь A отправил сообщение "Договор подписан"<br>**When:** Он редактирует его на "Договор подписан (черновик)"br>**Then:**br> - Сообщение обновлено у всех участников<br> - В истории отображается "редактировано" |
| **Test Data** | Сообщение: "Договор подписан" → "Договор подписан (черновик)"         |
| **Pass Criteria** | 1. Сообщение обновлено<br>2. История содержит отметку о редактировании<br>3. Время редактирования ≤5 мин |
| **Environment** | STAGING (веб-интерфейс)                                                |

---

### **FR-011: Управление участниками**
| **Test ID** | T-011                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-011                                                               |
| **Scenario** | Администратор удаляет участника из чата                               |
| **Preconditions** | 1. Чат содержит 5 участников<br>2. Пользователь авторизован как администратор |
| **Test Steps** | **Given:** Администратор в групповом чате<br>**When:** Удаляет участника user3<br>**Then:**br> - У user3 больше нет доступа к чату<br> - История чата сохранена<br> - В аудите запись об удалении участника |
| **Test Data** | Участники: user1–user5<br>Удаляется: user3                             |
| **Pass Criteria** | 1. Участник удален<br>2. История сохранена<br>3. Запись в аудите присутствует |
| **Environment** | DEV (чат, RBAC)                                                       |

---

### **FR-012: Кроссплатформенная синхронизация**
| **Test ID** | T-012                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-012                                                               |
| **Scenario** | Отправка сообщения с API и его отображение в веб- и мобильном клиенте  |
| **Preconditions** | 1. Пользователь авторизован через API<br>2. Чат открыт в вебе и на мобильном устройстве |
| **Test Steps** | **Given:** Отправлено сообщение через `/chat/send`br>**When:** Открывается чат в вебе и на телефоне<br>**Then:**br> - Сообщение отображается в обоих клиентах<br> - Статус "прочитано" синхронизируется |
| **Test Data** | Сообщение: "API-тест"<br>ID чата: CH-2024-002                        |
| **Pass Criteria** | 1. Сообщение появилось во всех клиентах<br>2. Статус прочитанности синхронизирован<br>3. Задержка ≤1.5 сек |
| **Environment** | STAGING (REST API, веб, мобильный)                                     |

---

### **FR-013: API для внешних интеграций**
| **Test ID** | T-013                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-013                                                               |
| **Scenario** | Вызов метода `/chat/list` через REST API                               |
| **Preconditions** | 1. У пользователя есть 5 чатов<br>2. Пользователь авторизован         |
| **Test Steps** | **Given:** Пользователь делает GET-запрос `/chat/list`br>**When:** Запрос обработан<br>**Then:**br> - Возвращается список чатов с метаданными<br> - Каждый чат содержит ID, участников, дату последнего сообщения |
| **Test Data** | Пользователь: userA<br>Чаты: 5 шт                                    |
| **Pass Criteria** | 1. Возвращено 5 чатов<br>2. Все поля присутствуют<br>3. HTTP-код 200<br>4. Время отклика ≤1.5 сек |
| **Environment** | DEV (Postman, Swagger)                                                 |

---

### **FR-014: Поддержка мультитенантности**
| **Test ID** | T-014                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-014                                                               |
| **Scenario** | Проверка изоляции данных между двумя приложениями                     |
| **Preconditions** | 1. Два приложения используют один движок<br>2. В каждом есть чаты      |
| **Test Steps** | **Given:** Приложение A и B используют один движок<br>**When:** В A создается чат CH-A-001<br>**Then:**br> - В B чат CH-A-001 недоступен<br> - В логах нет пересечений данных |
| **Test Data** | Приложение A: CH-A-001<br>Приложение B: CH-B-001                     |
| **Pass Criteria** | 1. Чаты не пересекаются<br>2. Данные изолированы<br>3. API возвращает 404 при попытке доступа из другого приложения |
| **Environment** | PROD-like (мультитенантный движок)                                     |

---

### **FR-015: Поддержка кастомных событий**
| **Test ID** | T-015                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-015                                                               |
| **Scenario** | Подписка на событие `onChatDeleted` через WebSocket                  |
| **Preconditions** | 1. Разработчик настроил слушатель событий<br>2. Чат существует         |
| **Test Steps** | **Given:** Разработчик подписан на WebSocket<br>**When:** Чат удален администратором<br>**Then:**br> - Получено событие `onChatDeleted`br> - Содержит ID удаленного чата |
| **Test Data** | ID чата: CH-2024-003                                                  |
| **Pass Criteria** | 1. Событие получено<br>2. Содержит корректный ID<br>3. HTTP-код 200 при подписке |
| **Environment** | DEV (WebSocket, логирование)                                           |

---

### **FR-016: Управление правами в чате**
| **Test ID** | T-016                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-016                                                               |
| **Scenario** | Установка прав "только чтение" для участника                           |
| **Preconditions** | 1. Чат существует<br>2. Пользователь B имеет права "только чтение"    |
| **Test Steps** | **Given:** Пользователь B в чате<br>**When:** Он пытается отправить сообщение "Привет"<br>**Then:**br> - Сообщение не отправляется<br> - Отображается ошибка "Нет прав"<br> - В логах запись о запрете |
| **Test Data** | Пользователь B, чат CH-2024-004                                       |
| **Pass Criteria** | 1. Сообщение не отправлено<br>2. Права корректно ограничены<br>3. Ошибка отображается |
| **Environment** | STAGING (веб-интерфейс, RBAC)                                          |

---

### **FR-017: Поиск по сообщениям**
| **Test ID** | T-017                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-017                                                               |
| **Scenario** | Поиск сообщений с текстом "договор"                                    |
| **Preconditions** | 1. В чате есть 20 сообщений<br>2. Несколько содержат "договор"        |
| **Test Steps** | **Given:** Пользователь открывает чат<br>**When:** Вводит в поиск "договор"<br>**Then:**br> - Отображаются все сообщения с этим словом<br> - Поддерживается регистронезависимость |
| **Test Data** | Поиск: "договор"<br>Сообщения: 3 шт                                   |
| **Pass Criteria** | 1. Найдено 3 сообщения<br>2. Поддержка регистра<br>3. Поиск работает по частичному совпадению |
| **Environment** | DEV (веб-интерфейс, Elasticsearch)                                    |

---

### **FR-018: Аудит действий в чате**
| **Test ID** | T-018                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-018                                                               |
| **Scenario** | Удаление сообщения администратором                                    |
| **Preconditions** | 1. Чат содержит сообщение от userA<br>2. Пользователь B — админ      |
| **Test Steps** | **Given:** Пользователь B удаляет сообщение userA<br>**When:** Через API или UI<br>**Then:**br> - Сообщение удалено у всех<br> - В аудите запись: `admin_id`, `message_id`, `timestamp` |
| **Test Data** | Сообщение: "Договор подписан"<br>ID: MSG-2024-001                     |
| **Pass Criteria** | 1. Сообщение удалено<br>2. Аудит содержит запись<br>3. Запись содержит корректные данные |
| **Environment** | PROD-like (логирование в БД)                                           |

---

### **FR-019: Поддержка кэширования**
| **Test ID** | T-019                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-019                                                               |
| **Scenario** | Повторный запрос истории чата через 10 сек                            |
| **Preconditions** | 1. История чата закэширована<br>2. Кэш ещё актуален                  |
| **Test Steps** | **Given:** Пользователь A запрашивает историю чата<br>**When:** Повторный запрос через 10 сек<br>**Then:**br> - Второй раз данные берутся из кэша<br> - Время отклика уменьшается на 30% |
| **Test Data** | ID чата: CH-2024-005<br>Сообщения: 15 шт                              |
| **Pass Criteria** | 1. Второй запрос быстрее на 30%br>2. Данные из кэша<br>3. Время отклика ≤0.5 сек |
| **Environment** | STAGING (Redis, PostgreSQL)                                             |

---

### **FR-020: Локализация и интернационализация**
| **Test ID** | T-020                                                                 |
|-------------|-----------------------------------------------------------------------|
| **Requirement** | FR-020                                                               |
| **Scenario** | Смена языка интерфейса на русский и английский                       |
| **Preconditions** | 1. Система поддерживает ru и en<br>2. Пользователь авторизован         |
| **Test Steps** | **Given:** Открыт чат с сообщением "Hello"<br>**When:** Язык изменен на "ru"<br>**Then:**br> - Все метки переведены<br> - Сообщение отображается на обоих языках<br> - Поддержка UTF-8 и дат |
| **Test Data** | Сообщение: "Hello"<br>Языки: ru, en                                   |
| **Pass Criteria** | 1. Все метки переведены<br>2. Сообщение отображается корректно<br>3. Нет ошибок кодировки |
| **Environment** | PROD (веб-интерфейс, i18n библиотека)                                |

---
