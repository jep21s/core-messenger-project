# API

#### 1. Сущности
**Чат (Chat)**

| Поле              | Бизнес-описание                                                                                                                          | Пример значения                          |
|-------------------|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
| contactType       | Название типа контактирования. <br/>Пример: корпоративный мессенджер,<br/>виджет на сайте для ответов клиенту,<br/>интеграция с telegram | TELEGRAM_BOT, CORPORATE_MSNGR            |
| chatType          | Название типа чата. Пример: Один на один, групповой чат, канал                                                                           | PRIVATE, GROUP, CHANNEL                  |
| createdAt         | Дата создания чата                                                                                                                       | 2025-04-05T14:30:00                      |
| updatedAt         | Дата обновления чата                                                                                                                     | 2025-08-05T17:35:30                      |
| latestMessageDate | Дата самого свежего сообщения в чате. Поле необходимое для сортировки чатов.                                                             | 2025-08-05T17:35:30                      |
| payload           | Дополнительная пользовательская информация по чату                                                                                       | json {}                                  |
| externalId        | id чата назначаемый внешней системой в строковом формате                                                                                 | a1b2c3d4-e5f6-4a7b-8c9d-0123456789ab, 42 |

**Сообщение (Message)**

| Поле        | Бизнес-описание                                               | Пример значения                          |
|-------------|---------------------------------------------------------------|------------------------------------------|
| chatId      | id чата к которому относится сообщение                        | a1b2c3d4-e5f6-4a7b-8c9d-0123456789ab     |
| messageType | Название типа сообщение                                       | TEXT, IMAGE, VIDEO                       |
| sendDate    | Дата отправки сообщения. Устанавливается внешней системой     | 2025-04-05T14:29:59                      |
| createdAt   | Дата создания сообщения                                       | 2025-04-05T14:30:00                      |
| updatedAt   | Дата обновления сообщения                                     | 2025-08-05T17:35:30                      |
| status      | Статус сообщения. Устанавливается внешней системой            | DELAYED_SENT, HIDDEN, DELETED            |
| body        | Тело сообщение                                                | Привет, как дела?                        |
| payload     | Дополнительная пользовательская информация по сообщению       | json {}                                  |
| externalId  | id сообщения назначаемый внешней системой в строковом формате | a1b2c3d4-e5f6-4a7b-8c9d-0123456789ab, 42 |


#### 2. Бизнес-функции (методы)
**CRUDS для чатов**
1. **`chat.create`** - Создание нового чата
   - *Бизнес-правило*: Все ограничения настраиваются на уровне пользовательского сервиса / Light messenger

2. **`chat.delete`** - Удаление существующего чата
   - *Бизнес-правило*: По умолчанию работает soft delete

3. **`chat.search`** - Поиск чатов
   - *Бизнес-правило*: Все ограничения настраиваются на уровне пользовательского сервиса / Light messenger

**CRUDS для сообщений**
1. **`message.create`** - Создание нового сообщения
   - *Бизнес-правило*: Сообщение может быть создано только для существующего чата

2. **`message.delete`** - Удаление существующего сообщения
   - *Бизнес-правило*: По умолчанию работает soft delete

3. **`message.status.update`** - Изменение статуса существующего сообщение
   - *Бизнес-правило*: Поддерживает массовое изменение статусов для множества сообщений

4. **`message.search`** - Поиск сообщений
   - *Бизнес-правило*: Все ограничения настраиваются на уровне пользовательского сервиса / Light messenger


#### 3. Бизнес-правила
**Chat**
1. **Типы чатов и контактов**:
   - Для каждого типа чата (`chatType`) и способа контактирования (`contactType`) могут быть свои правила видимости и доступа устанавливаемые внешней системой
   - Пример: чаты типа `CHANNEL` могут быть доступны только для чтения участникам

2. **Правила удаления**:
   - Hard delete возможен только при передаче флага в запрос
   - Soft delete не удаляет данные физически, а помечает чат как удалённый

3. **Доступ к чатам**:
   - Пользователь может просматривать только те чаты, к которым имеет доступ согласно политике внешнего сервиса

4. **Управление payload**:
   - Payload используется внешними сервисами для хранения метаданных, не влияющих на ядро чатов
   - Ядро не валидирует содержимое payload, только сохраняет и передаёт его по запросу

5. **Не уникальность externalId**:
   - Повторяющийся `externalId` для чатов допускается

**Message**
1. **Время отправки и создания**:
   - `sendDate` может быть установлено внешней системой, но не может быть позже текущего времени
   - `createdAt` устанавливается ядром автоматически при создании сообщения

2. **Типы сообщений**:
   - Поддерживаемые типы ядром не модерируются и всю проверку должен осуществлять внешний сервис

3. **Правила удаления сообщений**:
   - При `soft delete` сообщение скрывается из выдачи, но остаётся в базе
   - `hard delete` возможен только при передаче флага в запрос

4. **Статусы сообщений**:
   - Поддерживаемые типы ядром не модерируются и всю проверку должен осуществлять внешний сервис

5. **Управление payload**:
   - Payload используется внешними сервисами для хранения своих метаданных (например, теги, флаги, ссылки)
   - Ядро не валидирует содержимое payload, но сохраняет и возвращает его при запросах

6. **Не уникальность externalId**:
   - Повторяющийся `externalId` для сообщений допускается

#### 4. Бизнес-метрики успеха
**Chat**
1. **Скорость создания чата**: 95% операций `chat.create` должны выполняться менее чем за 500 мс
2. **Время поиска чатов**: 95% запросов `chat.search` — менее чем за 1 секунду
3. **Доступность сервиса**: API должен быть доступен не менее чем 99.9% времени
4. **Процент успешных операций**: 99% всех запросов к API должны завершаться без ошибок (без 5xx)
5. **Ограничения на запросы**:
   - Пользователи с базовым тарифом: до 50 запросов/мин
   - Пользователи с премиум-тарифом: до 200 запросов/мин
   - Пользователи с полным пакетом: без ограничений
   - Системные сервисы: не ограничены

**Message**
1. **Скорость создания сообщения**: 95% операций `message.create` должны выполняться менее чем за 300 мс
2. **Время обновления статуса**: 95% операций `message.status.update` — менее чем за 200 мс
3. **Время поиска сообщений**: 95% запросов `message.search` — менее чем за 1 секунду
4. **Доступность API**: Не менее 99.9% времени
5. **Процент успешных операций**: 99% всех запросов должны завершаться без ошибок (без 5xx)
6. **Ограничения на запросы**:
   - Пользователи с базовым тарифом: до 100 запросов/мин
   - Пользователи с премиум-тарифом: до 500 запросов/мин
   - Пользователи с полным пакетом: без ограничений
   - Системные сервисы: без ограничений