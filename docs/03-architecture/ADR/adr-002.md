
---

### ADR-002: –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–∏–Ω—è—Ç–æ  
**–î–∞—Ç–∞**: 2025-09-02  
**–£—á–∞—Å—Ç–Ω–∏–∫–∏**: Lead Architect, Backend Engineer, DevOps Engineer

#### 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–±–ª–µ–º–∞
> "–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∞—É–¥–∏—Ç–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö?"

#### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –∑–Ω–∞—á–∏–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (ASR)

| ID —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è | –¢–µ–∫—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è | –¢–∏–ø | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|---------------|------------------|-----|----------|
| STORAGE-001 | –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è | –§–¢ | –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ US-001 |
| STORAGE-002 | –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π | –§–¢ | –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ US-010 |
| STORAGE-003 | –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å soft delete —Å–æ–æ–±—â–µ–Ω–∏–π | –§–¢ | –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ US-001 |
| AUDIT-002 | –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∞—É–¥–∏—Ç–∞ | –ù–§–¢ | –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ US-010 |
| SCAL-005 | –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–æ–ª–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ 50 000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ù–§–¢ | –ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ US-008 |
| BACKUP-004 | –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å RPO ‚â§5 –º–∏–Ω –∏ RTO ‚â§15 –º–∏–Ω | –ù–§–¢ | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–æ–ª–∏—Ç–∏–∫–∞ |

#### 3. –ê–Ω–∞–ª–∏–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ \ –†–µ—à–µ–Ω–∏–µ | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î (PostgreSQL) | –î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –ë–î (MongoDB) | **–ì–∏–±—Ä–∏–¥: PostgreSQL + Event Sourcing** |
|----------------------|----------------------------|--------------------------|-----------------------------------------|
| **STORAGE-001**      | ‚úÖ                          | ‚úÖ                       | ‚úÖ |
| **STORAGE-002**      | ‚ö†Ô∏è (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É) | ‚úÖ                       | ‚úÖ (—á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è) |
| **STORAGE-003**      | ‚úÖ (—á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ `deleted_at`) | ‚úÖ                      | ‚úÖ |
| **AUDIT-002**        | ‚ö†Ô∏è (–ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—ã)  | ‚ö†Ô∏è (–ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ history) | ‚úÖ (—á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è –∏ –ª–æ–≥–∏) |
| **SCAL-005**         | ‚ùå (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–µ–µ) | ‚úÖ                      | ‚úÖ (–ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —à–∞—Ä–¥–∏–Ω–≥-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏) |
| **BACKUP-004**       | ‚úÖ                          | ‚ö†Ô∏è                      | ‚úÖ (—á–µ—Ä–µ–∑ Kafka –∏ –±—ç–∫–∞–ø—ã –ë–î) |

#### 4. –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ PostgreSQL –∏ Event Sourcing —á–µ—Ä–µ–∑ Kafka**:

- **–°–æ–æ–±—â–µ–Ω–∏—è** —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL:
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `messages(id, chat_id, user_id, text, created_at, updated_at, deleted_at)`
    - –ò–Ω–¥–µ–∫—Å—ã: –ø–æ `chat_id`, `user_id`, `created_at`

- **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ:
    - –ß–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ –≤ Kafka: `message_edited`, `message_deleted`, `message_read`
    - –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `message_history` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞

- **–ú–µ—Ö–∞–Ω–∏–∑–º soft delete**:
    - –ü–æ–ª–µ `deleted_at` –≤ —Ç–∞–±–ª–∏—Ü–µ `messages`
    - –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ `is_permanently_deleted` –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏

- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã PostgreSQL
    - Kafka Connect –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ S3/GCS

#### 5. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

–í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- **–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ (STORAGE-002)
- **–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∞—É–¥–∏—Ç–∞ (AUDIT-002)
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** –∑–∞ —Å—á—ë—Ç event-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —à–∞—Ä–¥–∏–Ω–≥–∞ –ë–î (SCAL-005)
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–µ RPO/RTO** —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Kafka –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã (BACKUP-004)

#### 6. –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

- ‚úÖ **–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ**:
    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–æ—á–µ—á–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    - –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞—É–¥–∏—Ç–∞
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ)

- ‚ö†Ô∏è **–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ**:
    - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑-–∑–∞ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –∏ –ë–î

- üîß **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
    - ADR-005: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    - ADR-006: –®–∞—Ä–¥–∏–Ω–≥ –ë–î
    - ADR-007: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç

#### 7. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------------|----------------|-----------|--------|
| STORAGE-001 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è | ‚úÖ |
| STORAGE-002 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è | ‚úÖ |
| STORAGE-003 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è | Soft delete —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è | ‚úÖ |
| AUDIT-002 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π | –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞ | ‚úÖ |
| SCAL-005 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π | –û–±—Ä–∞–±–æ—Ç–∫–∞ 50 000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ |
| BACKUP-004 | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞ | RPO=3 –º–∏–Ω, RTO=12 –º–∏–Ω | ‚úÖ |

---
